{"ast":null,"code":"import{useContext,useRef,createRef}from'react';import web3 from'../../../connection/web3';import Web3Context from'../../../store/web3-context';import CollectionContext from'../../../store/collection-context';import MarketplaceContext from'../../../store/marketplace-context';import{formatPrice}from'../../../helpers/utils';import eth from'../../../img/eth.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NFTCollection=function NFTCollection(){var web3Ctx=useContext(Web3Context);var collectionCtx=useContext(CollectionContext);var marketplaceCtx=useContext(MarketplaceContext);var priceRefs=useRef([]);if(priceRefs.current.length!==collectionCtx.collection.length){priceRefs.current=Array(collectionCtx.collection.length).fill().map(function(_,i){return priceRefs.current[i]||/*#__PURE__*/createRef();});}var makeOfferHandler=function makeOfferHandler(event,id,key){event.preventDefault();var enteredPrice=web3.utils.toWei(priceRefs.current[key].current.value,'ether');collectionCtx.contract.methods.approve(marketplaceCtx.contract.options.address,id).send({from:web3Ctx.account}).on('transactionHash',function(hash){marketplaceCtx.setMktIsLoading(true);}).on('receipt',function(receipt){marketplaceCtx.contract.methods.makeOffer(id,enteredPrice).send({from:web3Ctx.account}).on('error',function(error){window.alert('Something went wrong when pushing to the blockchain');marketplaceCtx.setMktIsLoading(false);});});};var buyHandler=function buyHandler(event){var buyIndex=parseInt(event.target.value);marketplaceCtx.contract.methods.fillOffer(marketplaceCtx.offers[buyIndex].offerId).send({from:web3Ctx.account,value:marketplaceCtx.offers[buyIndex].price}).on('transactionHash',function(hash){marketplaceCtx.setMktIsLoading(true);}).on('error',function(error){window.alert('Something went wrong when pushing to the blockchain');marketplaceCtx.setMktIsLoading(false);});};var cancelHandler=function cancelHandler(event){var cancelIndex=parseInt(event.target.value);marketplaceCtx.contract.methods.cancelOffer(marketplaceCtx.offers[cancelIndex].offerId).send({from:web3Ctx.account}).on('transactionHash',function(hash){marketplaceCtx.setMktIsLoading(true);}).on('error',function(error){window.alert('Something went wrong when pushing to the blockchain');marketplaceCtx.setMktIsLoading(false);});};return/*#__PURE__*/_jsx(\"div\",{className:\"row text-center\",children:collectionCtx.collection.map(function(NFT,key){var index=marketplaceCtx.offers?marketplaceCtx.offers.findIndex(function(offer){return offer.id===NFT.id;}):-1;var owner=index===-1?NFT.owner:marketplaceCtx.offers[index].user;var price=index!==-1?formatPrice(marketplaceCtx.offers[index].price).toFixed(2):null;return/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2 m-3 pb-3 card border-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(\"h5\",{className:\"card-title\",children:NFT.title})}),/*#__PURE__*/_jsx(\"img\",{src:\"https://ipfs.infura.io/ipfs/\".concat(NFT.img),className:\"card-img-bottom\",alt:\"NFT \".concat(key)}),/*#__PURE__*/_jsx(\"p\",{className:\"fw-light fs-6\",children:\"\".concat(owner.substr(0,7),\"...\").concat(owner.substr(owner.length-7))}),index!==-1?owner!==web3Ctx.account?/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"d-grid gap-2 col-5 mx-auto\",children:/*#__PURE__*/_jsx(\"button\",{onClick:buyHandler,value:index,className:\"btn btn-success\",children:\"BUY\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-7 d-flex justify-content-end\",children:[/*#__PURE__*/_jsx(\"img\",{src:eth,width:\"25\",height:\"25\",className:\"align-center float-start\",alt:\"price icon\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-start\",children:/*#__PURE__*/_jsx(\"b\",{children:\"\".concat(price)})})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"d-grid gap-2 col-5 mx-auto\",children:/*#__PURE__*/_jsx(\"button\",{onClick:cancelHandler,value:index,className:\"btn btn-danger\",children:\"CANCEL\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-7 d-flex justify-content-end\",children:[/*#__PURE__*/_jsx(\"img\",{src:eth,width:\"25\",height:\"25\",className:\"align-center float-start\",alt:\"price icon\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-start\",children:/*#__PURE__*/_jsx(\"b\",{children:\"\".concat(price)})})]})]}):owner===web3Ctx.account?/*#__PURE__*/_jsxs(\"form\",{className:\"row g-2\",onSubmit:function onSubmit(e){return makeOfferHandler(e,NFT.id,key);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-5 d-grid gap-2\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-secondary\",children:\"OFFER\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-7\",children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"ETH...\",className:\"form-control\",ref:priceRefs.current[key]})})]}):/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"br\",{})})]},key);})});};export default NFTCollection;","map":{"version":3,"sources":["C:/Users/pavik/Desktop/nft-marketplace/src/components/Content/NFTCollection/NFTCollection.js"],"names":["useContext","useRef","createRef","web3","Web3Context","CollectionContext","MarketplaceContext","formatPrice","eth","NFTCollection","web3Ctx","collectionCtx","marketplaceCtx","priceRefs","current","length","collection","Array","fill","map","_","i","makeOfferHandler","event","id","key","preventDefault","enteredPrice","utils","toWei","value","contract","methods","approve","options","address","send","from","account","on","hash","setMktIsLoading","receipt","makeOffer","error","window","alert","buyHandler","buyIndex","parseInt","target","fillOffer","offers","offerId","price","cancelHandler","cancelIndex","cancelOffer","NFT","index","findIndex","offer","owner","user","toFixed","title","img","substr","e"],"mappings":"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","sourcesContent":["import { useContext, useRef, createRef } from 'react';\r\n\r\nimport web3 from '../../../connection/web3';\r\nimport Web3Context from '../../../store/web3-context';\r\nimport CollectionContext from '../../../store/collection-context';\r\nimport MarketplaceContext from '../../../store/marketplace-context';\r\nimport { formatPrice } from '../../../helpers/utils';\r\nimport eth from '../../../img/eth.png';\r\n\r\nconst NFTCollection = () => {\r\n  const web3Ctx = useContext(Web3Context);\r\n  const collectionCtx = useContext(CollectionContext);\r\n  const marketplaceCtx = useContext(MarketplaceContext);\r\n\r\n  const priceRefs = useRef([]);\r\n  if (priceRefs.current.length !== collectionCtx.collection.length) {\r\n    priceRefs.current = Array(collectionCtx.collection.length).fill().map((_, i) => priceRefs.current[i] || createRef());\r\n  }\r\n  \r\n  const makeOfferHandler = (event, id, key) => {\r\n    event.preventDefault();\r\n\r\n    const enteredPrice = web3.utils.toWei(priceRefs.current[key].current.value, 'ether');\r\n\r\n    collectionCtx.contract.methods.approve(marketplaceCtx.contract.options.address, id).send({ from: web3Ctx.account })\r\n    .on('transactionHash', (hash) => {\r\n      marketplaceCtx.setMktIsLoading(true);\r\n    })\r\n    .on('receipt', (receipt) => {      \r\n      marketplaceCtx.contract.methods.makeOffer(id, enteredPrice).send({ from: web3Ctx.account })\r\n      .on('error', (error) => {\r\n        window.alert('Something went wrong when pushing to the blockchain');\r\n        marketplaceCtx.setMktIsLoading(false);\r\n      }); \r\n    });\r\n  };\r\n  \r\n  const buyHandler = (event) => {    \r\n    const buyIndex = parseInt(event.target.value);      \r\n    marketplaceCtx.contract.methods.fillOffer(marketplaceCtx.offers[buyIndex].offerId).send({ from: web3Ctx.account, value: marketplaceCtx.offers[buyIndex].price })\r\n    .on('transactionHash', (hash) => {\r\n      marketplaceCtx.setMktIsLoading(true);\r\n    })\r\n    .on('error', (error) => {\r\n      window.alert('Something went wrong when pushing to the blockchain');\r\n      marketplaceCtx.setMktIsLoading(false);\r\n    });            \r\n  };\r\n\r\n  const cancelHandler = (event) => {    \r\n    const cancelIndex = parseInt(event.target.value);\r\n    marketplaceCtx.contract.methods.cancelOffer(marketplaceCtx.offers[cancelIndex].offerId).send({ from: web3Ctx.account })\r\n    .on('transactionHash', (hash) => {\r\n      marketplaceCtx.setMktIsLoading(true);\r\n    })\r\n    .on('error', (error) => {\r\n      window.alert('Something went wrong when pushing to the blockchain');\r\n      marketplaceCtx.setMktIsLoading(false);\r\n    });    \r\n  };\r\n \r\n  return(\r\n    <div className=\"row text-center\">\r\n      {collectionCtx.collection.map((NFT, key) => {\r\n        const index = marketplaceCtx.offers ? marketplaceCtx.offers.findIndex(offer => offer.id === NFT.id) : -1;\r\n        const owner = index === -1 ? NFT.owner : marketplaceCtx.offers[index].user;\r\n        const price = index !== -1 ? formatPrice(marketplaceCtx.offers[index].price).toFixed(2) : null;\r\n\r\n        return(\r\n          <div key={key} className=\"col-md-2 m-3 pb-3 card border-info\">\r\n            <div className={\"card-body\"}>       \r\n              <h5 className=\"card-title\">{NFT.title}</h5>\r\n            </div>\r\n            <img src={`https://ipfs.infura.io/ipfs/${NFT.img}`} className=\"card-img-bottom\" alt={`NFT ${key}`} />                         \r\n            <p className=\"fw-light fs-6\">{`${owner.substr(0,7)}...${owner.substr(owner.length - 7)}`}</p>\r\n            {index !== -1 ?\r\n              owner !== web3Ctx.account ?\r\n                <div className=\"row\">\r\n                  <div className=\"d-grid gap-2 col-5 mx-auto\">\r\n                    <button onClick={buyHandler} value={index} className=\"btn btn-success\">BUY</button>\r\n                  </div>\r\n                  <div className=\"col-7 d-flex justify-content-end\">\r\n                    <img src={eth} width=\"25\" height=\"25\" className=\"align-center float-start\" alt=\"price icon\"></img>                \r\n                    <p className=\"text-start\"><b>{`${price}`}</b></p>\r\n                  </div>\r\n                </div> :\r\n                <div className=\"row\">\r\n                  <div className=\"d-grid gap-2 col-5 mx-auto\">\r\n                    <button onClick={cancelHandler} value={index} className=\"btn btn-danger\">CANCEL</button>\r\n                  </div>\r\n                  <div className=\"col-7 d-flex justify-content-end\">\r\n                    <img src={eth} width=\"25\" height=\"25\" className=\"align-center float-start\" alt=\"price icon\"></img>                \r\n                    <p className=\"text-start\"><b>{`${price}`}</b></p>\r\n                  </div>\r\n                </div> :\r\n              owner === web3Ctx.account ?              \r\n                <form className=\"row g-2\" onSubmit={(e) => makeOfferHandler(e, NFT.id, key)}>                \r\n                  <div className=\"col-5 d-grid gap-2\">\r\n                    <button type=\"submit\" className=\"btn btn-secondary\">OFFER</button>\r\n                  </div>\r\n                  <div className=\"col-7\">\r\n                    <input\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      placeholder=\"ETH...\"\r\n                      className=\"form-control\"\r\n                      ref={priceRefs.current[key]}\r\n                    />\r\n                  </div>                                  \r\n                </form> :\r\n                <p><br/></p>}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NFTCollection;"]},"metadata":{},"sourceType":"module"}